#!/bin/bash

# Test Script: Verify Real-Time Reactions

echo "ğŸ§ª Testing Real-Time Message Reactions"
echo "======================================="

echo ""
echo "ğŸ“‹ Test Instructions:"
echo "1. Start your backend server: cd backend && go run main.go"
echo "2. Start your frontend: cd frontend && npm run dev"
echo "3. Open two browser windows/tabs with different users"
echo "4. Follow the test steps below"

echo ""
echo "ğŸ”§ Test Steps:"
echo ""

echo "Step 1: Send Test Messages"
echo "-------------------------"
echo "User A: Send 'Message 1: React to this! ğŸ˜Š'"
echo "User B: Send 'Message 2: And this one too! ğŸ‰'"
echo "User A: Send 'Message 3: Try multiple reactions'"

echo ""
echo "Step 2: Test Real-Time Reaction Adding"
echo "-------------------------------------"
echo "User A: Add reaction ğŸ‘ to User B's 'Message 2'"
echo "âœ… Verify User B sees the ğŸ‘ reaction INSTANTLY"
echo ""
echo "User B: Add reaction â¤ï¸ to User A's 'Message 1'"
echo "âœ… Verify User A sees the â¤ï¸ reaction INSTANTLY"
echo ""
echo "User A: Add reaction ğŸ˜‚ to their own 'Message 3'"
echo "âœ… Verify User B sees the ğŸ˜‚ reaction INSTANTLY"

echo ""
echo "Step 3: Test Multiple Reactions"
echo "-------------------------------"
echo "User B: Add reaction ğŸ‘ to User A's 'Message 3'"
echo "User A: Add reaction ğŸ‰ to User A's 'Message 3'"
echo "âœ… Verify both users see: ğŸ˜‚ğŸ‘ğŸ‰ with correct counts"

echo ""
echo "Step 4: Test Real-Time Reaction Removal"
echo "----------------------------------------"
echo "User A: Remove their ğŸ‘ reaction from User B's 'Message 2'"
echo "âœ… Verify User B sees the ğŸ‘ reaction disappear INSTANTLY"
echo ""
echo "User B: Remove their â¤ï¸ reaction from User A's 'Message 1'"  
echo "âœ… Verify User A sees the â¤ï¸ reaction disappear INSTANTLY"

echo ""
echo "Step 5: Test Page Refresh Persistence"
echo "-------------------------------------"
echo "User A: Refresh the page (F5 or Ctrl+R)"
echo "User B: Refresh the page (F5 or Ctrl+R)"
echo "âœ… Verify all remaining reactions are still visible after refresh"

echo ""
echo "âœ… Expected Real-Time Behavior:"
echo "------------------------------"
echo "â€¢ Reactions appear INSTANTLY without refresh"
echo "â€¢ Reaction counts update in real-time"
echo "â€¢ Multiple users can react to same message"
echo "â€¢ Removing reactions updates immediately"
echo "â€¢ Same reaction from different users shows correct count"
echo "â€¢ Users can react to their own messages"
echo "â€¢ Reactions persist after page refresh"

echo ""
echo "âŒ If reactions don't appear in real-time:"
echo "-----------------------------------------"
echo "Check these potential issues:"
echo "1. WebSocket connection status in browser console"
echo "2. Backend WebSocket broadcasting logs"
echo "3. Frontend reaction event handling"
echo "4. API response timing"

echo ""
echo "ğŸ” Debugging Commands:"
echo "---------------------"
echo "Frontend Console:"
echo "â€¢ Check for 'Sending reaction:' log messages"
echo "â€¢ Look for WebSocket message received logs"
echo "â€¢ Verify no JavaScript errors"
echo ""
echo "Backend Console:"
echo "â€¢ Should see reaction add/remove API calls"
echo "â€¢ Should see WebSocket broadcast messages"
echo ""
echo "Network Tab:"
echo "â€¢ POST /message/reaction/add should return 200"
echo "â€¢ POST /message/reaction/remove should return 200"

echo ""
echo "ğŸ¯ Success Criteria:"
echo "-------------------"
echo "âœ… Reactions appear instantly on both ends"
echo "âœ… Reaction counts are accurate"
echo "âœ… Multiple reactions work correctly"
echo "âœ… Reaction removal works in real-time"
echo "âœ… Reactions persist after refresh"
echo "âœ… No duplicate or missing reactions"
echo "âœ… WebSocket connection remains stable"
echo "âœ… No console errors during testing"

echo ""
echo "ğŸš€ Flow Verification:"
echo "--------------------"
echo "User A clicks reaction â†’ API updates DB â†’ Backend broadcasts WebSocket â†’ User B sees reaction instantly"

echo ""
echo "Ready to test real-time reactions! ğŸ¬"
